{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/yourusername/riso/schemas/release-workflow.schema.json",
  "title": "Riso Release Workflow Configuration",
  "description": "JSON Schema for validating GitHub Actions workflow files (riso-release.yml) generated by the Riso template changelog module.",
  "type": "object",
  "required": ["name", "on", "jobs"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Workflow name displayed in GitHub Actions UI",
      "default": "Release"
    },
    "on": {
      "type": "object",
      "description": "Workflow trigger events",
      "properties": {
        "push": {
          "type": "object",
          "description": "Trigger on push events to specified branches",
          "properties": {
            "branches": {
              "type": "array",
              "description": "Branches that trigger releases",
              "items": {
                "type": "string"
              },
              "default": ["main"]
            }
          }
        },
        "workflow_dispatch": {
          "type": "object",
          "description": "Allow manual workflow triggering from Actions UI",
          "properties": {
            "inputs": {
              "type": "object",
              "description": "Manual workflow inputs",
              "properties": {
                "dry_run": {
                  "type": "object",
                  "description": "Test release without publishing",
                  "properties": {
                    "description": {
                      "type": "string",
                      "default": "Run release in dry-run mode (no publishing)"
                    },
                    "required": {
                      "type": "boolean",
                      "default": false
                    },
                    "type": {
                      "type": "string",
                      "enum": ["boolean"],
                      "default": "boolean"
                    },
                    "default": {
                      "type": "boolean",
                      "default": false
                    }
                  }
                }
              }
            }
          }
        }
      },
      "anyOf": [
        {"required": ["push"]},
        {"required": ["workflow_dispatch"]}
      ]
    },
    "jobs": {
      "type": "object",
      "description": "Workflow jobs",
      "required": ["release"],
      "properties": {
        "release": {
          "type": "object",
          "description": "Main release job",
          "required": ["runs-on", "steps"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Job display name",
              "default": "Semantic Release"
            },
            "runs-on": {
              "type": "string",
              "description": "GitHub Actions runner type",
              "enum": ["ubuntu-latest", "ubuntu-22.04", "ubuntu-20.04"],
              "default": "ubuntu-latest"
            },
            "needs": {
              "type": "array",
              "description": "Jobs that must complete before this job runs",
              "items": {
                "type": "string"
              },
              "default": ["quality"]
            },
            "if": {
              "type": "string",
              "description": "Conditional job execution expression",
              "examples": [
                "github.ref == 'refs/heads/main'",
                "contains(github.event.head_commit.message, 'skip release') == false"
              ]
            },
            "timeout-minutes": {
              "type": "integer",
              "description": "Maximum job execution time",
              "minimum": 5,
              "maximum": 60,
              "default": 20
            },
            "steps": {
              "type": "array",
              "description": "Sequential job steps",
              "minItems": 4,
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Step display name"
                  },
                  "uses": {
                    "type": "string",
                    "description": "GitHub Action to run",
                    "pattern": "^[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+@(v[0-9]+(\\.[0-9]+)?|[a-f0-9]{40})$",
                    "examples": [
                      "actions/checkout@v4",
                      "actions/setup-node@v4",
                      "actions/setup-python@v5"
                    ]
                  },
                  "with": {
                    "type": "object",
                    "description": "Action inputs",
                    "additionalProperties": true
                  },
                  "run": {
                    "type": "string",
                    "description": "Shell command to execute"
                  },
                  "env": {
                    "type": "object",
                    "description": "Environment variables for this step",
                    "additionalProperties": {
                      "type": "string"
                    }
                  },
                  "if": {
                    "type": "string",
                    "description": "Conditional step execution expression"
                  }
                },
                "oneOf": [
                  {"required": ["uses"]},
                  {"required": ["run"]}
                ]
              }
            },
            "permissions": {
              "type": "object",
              "description": "GITHUB_TOKEN permissions for this job",
              "properties": {
                "contents": {
                  "type": "string",
                  "enum": ["read", "write"],
                  "default": "write"
                },
                "issues": {
                  "type": "string",
                  "enum": ["read", "write"],
                  "default": "write"
                },
                "pull-requests": {
                  "type": "string",
                  "enum": ["read", "write"],
                  "default": "write"
                },
                "packages": {
                  "type": "string",
                  "enum": ["read", "write"],
                  "default": "write"
                }
              }
            }
          }
        }
      }
    },
    "env": {
      "type": "object",
      "description": "Global environment variables for all jobs",
      "properties": {
        "GITHUB_TOKEN": {
          "type": "string",
          "description": "GitHub token for API access",
          "default": "${{ secrets.GITHUB_TOKEN }}"
        },
        "PYPI_TOKEN": {
          "type": "string",
          "description": "PyPI authentication token (Python projects)",
          "default": "${{ secrets.PYPI_TOKEN }}"
        },
        "NPM_TOKEN": {
          "type": "string",
          "description": "npm authentication token (Node projects)",
          "default": "${{ secrets.NPM_TOKEN }}"
        },
        "DOCKER_HUB_USERNAME": {
          "type": "string",
          "description": "Docker Hub username (container projects)",
          "default": "${{ secrets.DOCKER_HUB_USERNAME }}"
        },
        "DOCKER_HUB_TOKEN": {
          "type": "string",
          "description": "Docker Hub access token (container projects)",
          "default": "${{ secrets.DOCKER_HUB_TOKEN }}"
        }
      }
    }
  },
  "examples": [
    {
      "name": "Release",
      "on": {
        "push": {
          "branches": ["main"]
        },
        "workflow_dispatch": {
          "inputs": {
            "dry_run": {
              "description": "Run release in dry-run mode (no publishing)",
              "required": false,
              "type": "boolean",
              "default": false
            }
          }
        }
      },
      "jobs": {
        "release": {
          "name": "Semantic Release",
          "runs-on": "ubuntu-latest",
          "needs": ["quality"],
          "timeout-minutes": 20,
          "permissions": {
            "contents": "write",
            "issues": "write",
            "pull-requests": "write",
            "packages": "write"
          },
          "steps": [
            {
              "name": "Checkout code",
              "uses": "actions/checkout@v4",
              "with": {
                "fetch-depth": 0,
                "persist-credentials": false
              }
            },
            {
              "name": "Setup Node.js",
              "uses": "actions/setup-node@v4",
              "with": {
                "node-version": "20",
                "cache": "pnpm"
              }
            },
            {
              "name": "Setup Python",
              "uses": "actions/setup-python@v5",
              "with": {
                "python-version": "3.11",
                "cache": "pip"
              },
              "if": "contains(fromJSON('[\"python\"]'), matrix.project)"
            },
            {
              "name": "Install dependencies",
              "run": "pnpm install --frozen-lockfile"
            },
            {
              "name": "Run semantic-release",
              "run": "npx semantic-release",
              "env": {
                "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}",
                "PYPI_TOKEN": "${{ secrets.PYPI_TOKEN }}",
                "NPM_TOKEN": "${{ secrets.NPM_TOKEN }}"
              }
            }
          ]
        }
      }
    }
  ]
}
