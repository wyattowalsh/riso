"""GraphQL Authentication Tests - Per-field auth and permissions."""

{% if graphql_api_module == 'enabled' %}
import pytest
from strawberry.test import BaseGraphQLTestClient

from {{ package_name }}.graphql_api.schema import schema


@pytest.fixture
def graphql_client():
    """Create GraphQL test client."""
    return BaseGraphQLTestClient(schema)


class TestAuthentication:
    """Test authentication requirements on mutations."""
    
    def test_public_query_no_auth_required(self, graphql_client):
        """Test that queries don't require authentication."""
        query = """
            query {
                user(id: "1") {
                    id
                    name
                }
            }
        """
        
        result = graphql_client.query(query)
        
        # Public queries should work without auth
        assert result.errors is None
        assert result.data["user"]["id"] == "1"
    
    # NOTE: These tests would require auth middleware to be implemented
    # For now, they serve as documentation of expected behavior
    
    # def test_mutation_requires_auth(self, graphql_client):
    #     """Test that mutations require authentication."""
    #     mutation = """
    #         mutation {
    #             createUser(input: {name: "Test", email: "test@example.com"}) {
    #                 id
    #             }
    #         }
    #     """
    #     
    #     result = graphql_client.query(mutation)
    #     
    #     # Should return auth error
    #     assert result.errors is not None
    #     assert any("auth" in str(error).lower() for error in result.errors)
{% endif %}
