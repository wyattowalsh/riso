"""
API playground configuration utilities.
Feature: 018-docs-sites-overhaul
Generated by Riso template for {{ project_name }}
"""

from pathlib import Path
from typing import Dict, Optional


class APIPlaygroundConfig:
    """Configure API playground integrations (Swagger UI, ReDoc)."""

    def __init__(self, playground_type: str = "swagger"):
        """
        Initialize API playground configuration.
        
        Args:
            playground_type: Type of playground (swagger, redoc, both)
        """
        self.playground_type = playground_type
        self.swagger_enabled = playground_type in ["swagger", "both"]
        self.redoc_enabled = playground_type in ["redoc", "both"]

    def get_openapi_config(self) -> Dict[str, any]:
        """
        Get OpenAPI configuration for the API playground.
        
        Returns:
            Configuration dictionary for OpenAPI/Swagger
        """
        return {
            "title": "{{ project_name }} API",
            "version": "1.0.0",
            "description": "API documentation for {{ project_name }}",
            "contact": {
                "name": "API Support",
                "url": "https://{{ project_slug }}.example.com/support",
                "email": "support@{{ project_slug }}.example.com"
            },
            "license": {
                "name": "MIT",
                "url": "https://opensource.org/licenses/MIT"
            }
        }

    def get_swagger_ui_config(self) -> Dict[str, any]:
        """
        Get Swagger UI configuration.
        
        Returns:
            Swagger UI configuration dictionary
        """
        if not self.swagger_enabled:
            return {}
        
        return {
            "docExpansion": "list",
            "defaultModelsExpandDepth": 1,
            "defaultModelExpandDepth": 1,
            "displayRequestDuration": True,
            "filter": True,
            "showExtensions": True,
            "showCommonExtensions": True,
            "tryItOutEnabled": True
        }

    def get_redoc_config(self) -> Dict[str, any]:
        """
        Get ReDoc configuration.
        
        Returns:
            ReDoc configuration dictionary
        """
        if not self.redoc_enabled:
            return {}
        
        return {
            "hideDownloadButton": False,
            "expandResponses": "200,201",
            "requiredPropsFirst": True,
            "sortPropsAlphabetically": True,
            "pathInMiddlePanel": True,
            "nativeScrollbars": True
        }

    def generate_sphinx_config(self, docs_dir: Path) -> str:
        """
        Generate Sphinx configuration for API playground.
        
        Args:
            docs_dir: Documentation directory path
            
        Returns:
            Sphinx configuration snippet
        """
        if not self.swagger_enabled and not self.redoc_enabled:
            return ""
        
        config_lines = []
        
        if self.swagger_enabled:
            config_lines.extend([
                "# Swagger UI configuration",
                "html_js_files = [",
                "    ('https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js', {'defer': 'defer'}),",
                "]",
                "html_css_files = [",
                "    'https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css',",
                "]",
                ""
            ])
        
        if self.redoc_enabled:
            config_lines.extend([
                "# ReDoc configuration",
                "html_js_files.append(",
                "    ('https://cdn.jsdelivr.net/npm/redoc@latest/bundles/redoc.standalone.js', {'defer': 'defer'})",
                ")",
                ""
            ])
        
        return "\n".join(config_lines)

    def generate_fumadocs_config(self) -> str:
        """
        Generate Fumadocs configuration for API playground.
        
        Returns:
            Fumadocs configuration snippet
        """
        if not self.swagger_enabled and not self.redoc_enabled:
            return ""
        
        return """
// API Playground Configuration
export const apiPlaygroundConfig = {
  swagger: {
    enabled: %s,
    url: '/api/openapi.json',
  },
  redoc: {
    enabled: %s,
    url: '/api/openapi.json',
  },
};
""" % (str(self.swagger_enabled).lower(), str(self.redoc_enabled).lower())

    def generate_docusaurus_plugin(self) -> str:
        """
        Generate Docusaurus plugin configuration for API playground.
        
        Returns:
            Docusaurus plugin configuration
        """
        if not self.swagger_enabled and not self.redoc_enabled:
            return ""
        
        plugins = []
        
        if self.swagger_enabled:
            plugins.append("""
    [
      'docusaurus-plugin-openapi-docs',
      {
        id: 'api',
        docsPluginId: 'classic',
        config: {
          api: {
            specPath: 'openapi.json',
            outputDir: 'docs/api',
            sidebarOptions: {
              groupPathsBy: 'tag',
            },
          },
        },
      },
    ],
""")
        
        return "".join(plugins)


def create_openapi_spec_template() -> Dict[str, any]:
    """
    Create basic OpenAPI specification template.
    
    Returns:
        OpenAPI 3.0 specification dictionary
    """
    return {
        "openapi": "3.0.0",
        "info": {
            "title": "{{ project_name }} API",
            "version": "1.0.0",
            "description": "API specification for {{ project_name }}"
        },
        "servers": [
            {
                "url": "http://localhost:8000",
                "description": "Development server"
            }
        ],
        "paths": {},
        "components": {
            "schemas": {},
            "securitySchemes": {}
        }
    }
