{%- if cli_module | lower != "enabled" %}
# CLI module disabled - this file is not generated
{%- else %}
"""Init command - initialize application resources."""

from __future__ import annotations

import time
from pathlib import Path

import typer
from rich.progress import Progress, SpinnerColumn, TextColumn

from {{ package_name }}.cli.core import command
from {{ package_name }}.cli.core.formatter import OutputFormatter
from {{ package_name }}.cli.core.prompts import confirm

# Initialize formatter
formatter = OutputFormatter()


@command(
    name="init",
    help="Initialize application configuration and resources",
)
def init_command(
    force: bool = typer.Option(False, "--force", "-f", help="Overwrite existing configuration"),
    config_path: str = typer.Option("config.toml", "--config", "-c", help="Configuration file path"),
    interactive: bool = typer.Option(True, "--interactive/--no-interactive", help="Show progress indicators"),
) -> None:
    """Initialize application resources.
    
    Args:
        force: Whether to overwrite existing files
        config_path: Path to configuration file
        interactive: Whether to show progress indicators
    """
    config_file = Path(config_path)
    
    # Check if config already exists
    if config_file.exists() and not force:
        if not confirm(f"Configuration file '{config_file}' already exists. Overwrite?", default=False):
            formatter.print_info("Initialization cancelled")
            raise typer.Exit(code=0)
    
    # Create default configuration with progress indicator
    default_config = """# {{ project_name }} Configuration
# Generated by init command

[app]
name = "{{ project_name }}"
version = "0.1.0"

[logging]
level = "INFO"
format = "json"

[features]
cli_enabled = true
"""
    
    if interactive:
        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console=formatter.console,
        ) as progress:
            task = progress.add_task("Initializing configuration...", total=None)
            time.sleep(0.5)  # Simulate work
            
            try:
                config_file.write_text(default_config)
                progress.update(task, completed=True)
            except Exception as e:
                formatter.print_error(f"Failed to create configuration: {e}")
                raise typer.Exit(code=1)
    else:
        try:
            config_file.write_text(default_config)
        except Exception as e:
            formatter.print_error(f"Failed to create configuration: {e}")
            raise typer.Exit(code=1)
    
    formatter.print_success(f"Created configuration file: {config_file}")
    
    # Show what was created in a table
    init_summary = [
        {"resource": "Configuration File", "path": str(config_file), "status": "✓ Created"},
        {"resource": "Default Settings", "path": "app, logging, features", "status": "✓ Applied"},
    ]
    
    formatter.print("\nInitialization Summary:")
    formatter.format(init_summary, format="table")
{%- endif %}
