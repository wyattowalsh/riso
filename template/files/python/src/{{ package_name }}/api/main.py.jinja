{%- if api_tracks | lower not in ["python", "python+node"] %}
"""FastAPI service disabled for this render."""


def create_app():
    """Placeholder app when the Python API track is not enabled."""
    raise RuntimeError("FastAPI track disabled. Enable with api_tracks=python or python+node.")


app = None
{%- else %}
"""FastAPI application factory and initialization.

This module provides the main FastAPI application instance with
CORS middleware, error handlers, and route registration.
"""

from __future__ import annotations

from fastapi import FastAPI
from fastapi.responses import JSONResponse

from .config import get_config
from .middleware.cors import configure_cors
from .middleware.errors import configure_error_handlers
from .routes import health

# Import example routes (User Story 2)
try:
    from .routes import examples
    EXAMPLES_ENABLED = True
except ImportError:
    EXAMPLES_ENABLED = False


def create_app() -> FastAPI:
    """Create and configure the FastAPI application.

    Returns:
        FastAPI: Configured FastAPI application instance

    Example:
        >>> app = create_app()
        >>> # Run with: uvicorn module.api.main:app
    """
    config = get_config()

    # Create FastAPI app with enhanced metadata
    app = FastAPI(
        title=config.app_name,
        description="FastAPI application scaffolded with Riso template",
        version=config.version,
        docs_url="/docs",
        redoc_url="/redoc",
        openapi_tags=[
            {
                "name": "Health",
                "description": "Health check endpoints for monitoring and orchestration",
            },
            {
                "name": "Examples",
                "description": "Example CRUD endpoints demonstrating FastAPI patterns",
            },
        ],
    )

    # Configure CORS middleware
    configure_cors(app, config)

    # Configure error handlers
    configure_error_handlers(app)

    # Register routers
    app.include_router(health.router)
    if EXAMPLES_ENABLED:
        app.include_router(examples.router)

    # Root endpoint
    @app.get(
        "/",
        tags=["Root"],
        summary="API Root",
        description="Root endpoint with API information and documentation links",
    )
    async def root() -> dict[str, str]:
        """Root endpoint.

        Returns:
            dict: Welcome message with documentation links

        Example:
            GET /
            Response: {
                "message": "Welcome to {{ project_name }}",
                "docs": "/docs",
                "redoc": "/redoc"
            }
        """
        return {
            "message": "Welcome to {{ project_name }}",
            "docs": "/docs",
            "redoc": "/redoc",
        }

    return app


app = create_app()


if __name__ == "__main__":
    import uvicorn
    config = get_config()
    uvicorn.run(
        "{{ package_name }}.api.main:app",
        host=config.host,
        port=config.port,
        reload=config.reload,
        log_level=config.log_level.lower(),
    )
{%- endif %}
