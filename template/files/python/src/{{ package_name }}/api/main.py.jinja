{%- if api_tracks | lower not in ["python", "python+node"] %}
"""FastAPI application - disabled for this render."""


def create_app():
    """Placeholder app when the Python API track is not enabled."""
    raise RuntimeError("FastAPI track disabled. Enable with api_tracks=python or python+node.")


app = None
{%- else %}
"""FastAPI application entry point.

This module initializes the FastAPI application with:
- Configuration from environment variables
- CORS middleware for cross-origin requests
- Global error handlers for consistent error responses
- Route registration for all API endpoints
- Interactive API documentation at /docs and /redoc

Generated by Riso template.
"""
from __future__ import annotations

from fastapi import FastAPI
from fastapi.responses import JSONResponse

from {{ package_name }}.api.config import get_settings
from {{ package_name }}.api.middleware.cors import configure_cors
from {{ package_name }}.api.middleware.errors import configure_error_handlers
from {{ package_name }}.api.routes import health

# Conditionally import example routes
try:
    from {{ package_name }}.api.routes import examples
except ImportError:  # pragma: no cover
    examples = None  # type: ignore

# Load configuration
settings = get_settings()


def create_app() -> FastAPI:
    """Create and configure the FastAPI application.
    
    Initializes the application with all middleware, error handlers,
    and route registrations. This factory function allows for
    dependency injection in tests.
    
    Returns:
        Configured FastAPI application instance
    """
    # Create FastAPI app with metadata
    app = FastAPI(
        title=settings.app_name,
        description=f"API for {settings.app_name}. Generated by Riso template.",
        version=settings.version,
        docs_url="/docs",
        redoc_url="/redoc",
        openapi_url="/openapi.json",
        openapi_tags=[
            {
                "name": "Health",
                "description": "Health check endpoints for monitoring and orchestration",
            },
            {
                "name": "Examples",
                "description": "Example CRUD operations demonstrating FastAPI patterns",
            },
        ],
    )
    
    # Configure CORS middleware
    configure_cors(app, settings)
    
    # Configure error handlers
    configure_error_handlers(app, settings)
    
    # Register routers
    app.include_router(health.router)
    
    # Include example routes if available
    if examples is not None:
        app.include_router(examples.router)
    
    # Root endpoint
    @app.get(
        "/",
        tags=["Root"],
        summary="API root",
        description="Welcome message with links to documentation",
    )
    async def root() -> JSONResponse:
        """Root endpoint with API information.
        
        Returns basic information about the API including:
        - Welcome message
        - Version information
        - Links to interactive documentation
        - Current environment
        
        Example:
            GET /
            Response: {
                "message": "Welcome to MyApp API",
                "version": "0.1.0",
                "docs": "/docs",
                "redoc": "/redoc",
                "environment": "development"
            }
        """
        return JSONResponse(
            content={
                "message": f"Welcome to {settings.app_name}",
                "version": settings.version,
                "docs": "/docs",
                "redoc": "/redoc",
                "openapi": "/openapi.json",
                "environment": settings.environment,
            }
        )
    
    # Startup event
    @app.on_event("startup")
    async def startup_event() -> None:
        """Application startup event handler.
        
        Executes during application startup. Use for:
        - Database connection initialization
        - Cache warmup
        - Background task setup
        - Configuration validation
        """
        import logging
        logger = logging.getLogger(__name__)
        logger.info(
            f"Starting {settings.app_name} v{settings.version}",
            extra={
                "environment": settings.environment,
                "host": settings.host,
                "port": settings.port,
            }
        )
    
    # Shutdown event
    @app.on_event("shutdown")
    async def shutdown_event() -> None:
        """Application shutdown event handler.
        
        Executes during graceful shutdown. Use for:
        - Database connection cleanup
        - Cache flush
        - Background task cancellation
        - Resource cleanup
        """
        import logging
        logger = logging.getLogger(__name__)
        logger.info(f"Shutting down {settings.app_name}")
    
    return app


# Create application instance
app = create_app()
{%- endif %}
