{% if changelog_module == "enabled" -%}
"""Python release utilities for version management and changelog generation.

This module provides:
- Version parsing and comparison
- Changelog generation helpers
- Version file updates
- SemVer calculations

Generated by Riso template - Feature 014: Changelog & Release Management
"""

from typing import NamedTuple, Optional
import re


class Version(NamedTuple):
    """Semantic version representation."""
    
    major: int
    minor: int
    patch: int
    prerelease: Optional[str] = None
    build_metadata: Optional[str] = None

    @classmethod
    def parse(cls, version_str: str) -> "Version":
        """Parse a semantic version string.
        
        Args:
            version_str: Version string in format MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]
            
        Returns:
            Version: Parsed version object
            
        Raises:
            ValueError: If version string is invalid
            
        Example:
            >>> Version.parse("1.2.3")
            Version(major=1, minor=2, patch=3)
            >>> Version.parse("2.0.0-beta.1")
            Version(major=2, minor=2, patch=0, prerelease='beta.1')
        """
        # SemVer 2.0.0 regex pattern
        pattern = r'^(?P<major>0|[1-9]\d*)\.(?P<minor>0|[1-9]\d*)\.(?P<patch>0|[1-9]\d*)(?:-(?P<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?P<build_metadata>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$'
        
        match = re.match(pattern, version_str.lstrip('v'))
        if not match:
            raise ValueError(f"Invalid semantic version: {version_str}")
        
        return cls(
            major=int(match.group('major')),
            minor=int(match.group('minor')),
            patch=int(match.group('patch')),
            prerelease=match.group('prerelease'),
            build_metadata=match.group('build_metadata')
        )
    
    def __str__(self) -> str:
        """Convert version to string representation."""
        version = f"{self.major}.{self.minor}.{self.patch}"
        if self.prerelease:
            version += f"-{self.prerelease}"
        if self.build_metadata:
            version += f"+{self.build_metadata}"
        return version
    
    def bump_major(self) -> "Version":
        """Bump major version (resets minor and patch)."""
        return Version(major=self.major + 1, minor=0, patch=0)
    
    def bump_minor(self) -> "Version":
        """Bump minor version (resets patch)."""
        return Version(major=self.major, minor=self.minor + 1, patch=0)
    
    def bump_patch(self) -> "Version":
        """Bump patch version."""
        return Version(major=self.major, minor=self.minor, patch=self.patch + 1)


__all__ = ["Version"]
{% endif %}
