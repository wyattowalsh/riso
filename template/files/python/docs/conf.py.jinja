# Configuration file for the Sphinx documentation builder.
# Generated by Riso template for {{ project_name }}
# Feature: 018-docs-sites-overhaul
#
# For the full list of built-in configuration values, see the documentation:
# https://www.sphinx-doc.org/en/master/usage/configuration.html

import os
import sys

# -- Path setup --------------------------------------------------------------
# Add project root to path for autodoc (FR-003)
sys.path.insert(0, os.path.abspath('..'))

# -- Project information -----------------------------------------------------
project = '{{ project_name }}'
copyright = '2025, {{ project_name }} Team'
author = '{{ project_name }} Team'

# The short X.Y version
version = '0.1.0'
# The full version, including alpha/beta/rc tags
release = '0.1.0'

# -- General configuration ---------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/configuration.html#general-configuration

extensions = [
    'sphinx.ext.autodoc',       # Auto-generate API docs from docstrings (FR-003)
    'sphinx.ext.napoleon',      # Support Google/NumPy docstring styles (FR-003)
    'sphinx.ext.viewcode',      # Add links to source code
    'sphinx.ext.intersphinx',   # Link to other project's documentation
{% if docs_interactive_features == 'enabled' %}
    'sphinxcontrib.mermaid',    # Mermaid diagram support (FR-008)
{% endif %}
]

templates_path = ['_templates']
exclude_patterns = ['_build', 'Thumbs.db', '.DS_Store']

# -- Options for HTML output -------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/configuration.html#options-for-html-output

html_theme = 'shibuya'
html_static_path = ['_static']

# Shibuya theme options (FR-001, T013)
html_theme_options = {
{% if docs_theme_mode == 'dark' %}
    'dark_mode': True,
{% elif docs_theme_mode == 'light' %}
    'dark_mode': False,
{% else %}
    'dark_mode': 'auto',  # Follow system preference
{% endif %}
{% if docs_search_provider == 'local' %}
    'search_bar_position': 'sidebar',
{% endif %}
}

# -- Extension configuration -------------------------------------------------

# Autodoc configuration (FR-003, T015)
autodoc_default_options = {
    'members': True,
    'member-order': 'bysource',
    'special-members': '__init__',
    'undoc-members': True,
    'show-inheritance': True,
    'exclude-members': '__weakref__'
}

# Napoleon settings (Google/NumPy docstring styles)
napoleon_google_docstring = True
napoleon_numpy_docstring = True
napoleon_include_init_with_doc = False
napoleon_include_private_with_doc = False
napoleon_include_special_with_doc = True
napoleon_use_admonition_for_examples = False
napoleon_use_admonition_for_notes = False
napoleon_use_admonition_for_references = False
napoleon_use_ivar = False
napoleon_use_param = True
napoleon_use_rtype = True
napoleon_preprocess_types = False
napoleon_type_aliases = None
napoleon_attr_annotations = True

# Intersphinx configuration
intersphinx_mapping = {
    'python': ('https://docs.python.org/3', None),
}

# Linkcheck configuration (FR-012, T014)
linkcheck_retries = 3
linkcheck_timeout = 10
linkcheck_workers = 5
linkcheck_anchors = True
linkcheck_ignore = [
    r'http://localhost:\d+',      # Ignore local servers
    r'https://example\.com',      # Ignore placeholder domains
    r'https://127\.0\.0\.1:\d+',  # Ignore local IPs
]

{% if docs_interactive_features == 'enabled' %}
# Mermaid configuration (FR-008)
mermaid_version = '10.6.0'
{% if docs_theme_mode == 'dark' %}
mermaid_init_js = "mermaid.initialize({startOnLoad:true,theme:'dark'});"
{% elif docs_theme_mode == 'light' %}
mermaid_init_js = "mermaid.initialize({startOnLoad:true,theme:'default'});"
{% else %}
mermaid_init_js = "mermaid.initialize({startOnLoad:true,theme:'neutral'});"
{% endif %}
{% endif %}

{% if docs_api_playground == 'swagger' or docs_api_playground == 'both' %}
# Swagger UI configuration (FR-011)
html_js_files = [
    ('https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js', {'defer': 'defer'}),
]
html_css_files = [
    'https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css',
]
{% endif %}
