import pytest

{%- if api_tracks | lower not in ["python", "python+node"] %}
pytest.skip("Python API module disabled", allow_module_level=True)
{%- endif %}

from fastapi.testclient import TestClient


def test_health_endpoint_returns_ok(monkeypatch):
    monkeypatch.setenv("RISO_API_SERVICE_NAME", "riso-api")

    from {{ project_slug }}.api.main import app
    from {{ project_slug }}.api.settings import ApiSettings

    client = TestClient(app)
    response = client.get("/health")

    assert response.status_code == 200

    payload = response.json()
    assert payload["status"] == "ok"
    assert payload["service"] == ApiSettings().service_name


def test_settings_use_environment_overrides(monkeypatch):
    monkeypatch.setenv("RISO_API_HOST", "127.0.0.1")
    monkeypatch.setenv("RISO_API_PORT", "9090")

    from {{ project_slug }}.api.settings import ApiSettings

    settings = ApiSettings()
    assert settings.host == "127.0.0.1"
    assert settings.port == 9090
