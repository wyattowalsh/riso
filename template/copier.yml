_min_copier_version: "9.1.0"
_template: "."
_faq: true
_answers_file: ".copier-answers.yml"

metadata:
  name: "riso-template"
  version: "0.1.0"
  description: >
    Riso is a modular Copier template that defaults to a lightweight Python 3.11
    stack (uv, pytest, jupyter, ruff, mypy, pylint) and offers opt-in Typer CLI,
    FastAPI/Fastify services, fastmcp integrations, shared logic, and documentation
    variants powered by Fumadocs (Next.js), Sphinx Shibuya, and Docusaurus.
  maintainers:
    - "Riso Template Working Group"
  tags:
    - python
    - typer
    - fastapi
    - fastify
    - uv
    - pnpm
    - fumadocs
    - sphinx-shibuya
    - docusaurus

defaults:
  project_name: "riso-example"
  project_slug: "{{ project_name | replace(' ', '-') | lower }}"
  package_name: "{{ project_slug | replace('-', '_') }}"
  project_layout: "single-package"
  quality_profile: "standard"
  python_versions: ["3.11", "3.12", "3.13"]
  cli_module: "disabled"
  api_tracks: "none"
  graphql_api_module: "disabled"
  mcp_module: "disabled"
  websocket_module: "disabled"
  changelog_module: "disabled"
  docs_site: "fumadocs"
  shared_logic: "disabled"
  ci_platform: "github-actions"
  saas_starter_module: "disabled"
  saas_runtime: "nextjs-16"
  saas_hosting: "vercel"
  saas_database: "neon"
  saas_orm: "prisma"
  saas_auth: "clerk"
  saas_enterprise_bridge: "none"
  saas_billing: "stripe"
  saas_jobs: "triggerdev"
  saas_email: "resend"
  saas_analytics: "posthog"
  saas_ai: "openai"
  saas_storage: "r2"
  saas_cicd: "github-actions"
  # NEW: Expanded options and categories (Spec 017)
  saas_search: "none"
  saas_cache: "none"
  saas_feature_flags: "none"
  saas_cms: "none"
  saas_usage_metering: "none"
  saas_secrets: "none"
  saas_error_tracking: "sentry"
  saas_observability_sentry: true
  saas_observability_datadog: true
  saas_observability_otel: true
  saas_observability_structured_logging: true
  saas_include_fixtures: true
  saas_include_factories: true
  saas_test_suite_level: "standard"

prompts:
  project_name:
    type: str
    help: "Human friendly project name"
  project_layout:
    type: str
    help: "Choose the repository layout"
    choices:
      - single-package
      - monorepo
  quality_profile:
    type: str
    help: "Select baseline quality suite profile"
    choices:
      - standard
      - strict
  cli_module:
    type: str
    help: "Enable the Typer CLI scaffolding?"
    choices:
      - disabled
      - enabled
  api_tracks:
    type: str
    help: "Select API tracks to scaffold"
    choices:
      - none
      - python
      - node
      - python+node
  graphql_api_module:
    type: str
    help: "Enable GraphQL API scaffolding (Strawberry)?"
    choices:
      - disabled
      - enabled
    when: "{{ api_tracks in ['python', 'python+node'] }}"
  mcp_module:
    type: str
    help: "Enable fastmcp tooling module?"
    choices:
      - disabled
      - enabled
  websocket_module:
    type: str
    help: "Enable WebSocket real-time communication module?"
    choices:
      - disabled
      - enabled
    when: "{{ api_tracks in ['python', 'python+node'] }}"
  changelog_module:
    type: str
    help: "Enable changelog generation and release management?"
    choices:
      - disabled
      - enabled
  docs_site:
    type: str
    help: "Pick documentation variant"
    choices:
      - fumadocs
      - sphinx-shibuya
      - docusaurus
      - none
  shared_logic:
    type: str
    help: "Generate shared logic package?"
    choices:
      - disabled
      - enabled
  include_databases:
    type: str
    help: "Include PostgreSQL and Redis services in docker-compose?"
    choices:
      - "no"
      - "yes"
    when: "{{ api_tracks in ['python', 'node', 'python+node'] }}"
  ci_platform:
    type: str
    help: "Select CI/CD platform"
    choices:
      - github-actions
      - none
  
  # ========================================
  # SaaS Starter Module Prompts
  # ========================================
  saas_starter_module:
    type: str
    help: |
      Enable SaaS Starter module? Generates production-ready SaaS application with
      authentication, billing, database, background jobs, email, analytics, AI, storage,
      observability, and deployment configuration. Choose your technology stack across
      14 categories with binary choices (2 options per category).
    default: disabled
    choices:
      - enabled
      - disabled
  
  saas_runtime:
    type: str
    help: |
      Select runtime framework for your SaaS application:
      - Next.js 16: React 19.2, App Router, Turbopack, largest ecosystem, Vercel-first (recommended)
      - Remix 2.x: Server-first routes, explicit data loading, good for complex forms
      - SvelteKit 2.x: Lightweight, reactive, excellent performance, growing ecosystem
      - Astro 4.x: Content-focused sites, partial hydration, bring-your-own-framework
    default: nextjs-16
    choices:
      - nextjs-16
      - remix-2
      - sveltekit-2
      - astro-4
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_hosting:
    type: str
    help: |
      Select hosting platform:
      - Vercel: Native Next.js support, edge functions, image optimization, preview deployments (recommended)
      - Cloudflare: Global edge network, Pages + Workers, lower egress costs, R2 storage
      - Netlify: Instant rollbacks, split testing, distributed persistent rendering (DPR)
      - Railway: Container hosting, integrated databases, simple Dockerfile deployment
    default: vercel
    choices:
      - vercel
      - cloudflare
      - netlify
      - railway
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_database:
    type: str
    help: |
      Select database provider:
      - Neon: Serverless Postgres, database branching, autoscale-to-zero, CI/PR databases (recommended)
      - Supabase: Postgres + Auth + Storage + Edge Functions, all-in-one BaaS platform
      - PlanetScale: MySQL-compatible, non-blocking schema changes, horizontal sharding
      - CockroachDB: Distributed Postgres, multi-region, strong consistency, regulatory compliance
    default: neon
    choices:
      - neon
      - supabase
      - planetscale
      - cockroachdb
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_orm:
    type: str
    help: |
      Select ORM for database access:
      - Prisma: Best TypeScript ergonomics, schema DSL, Prisma Studio, migration workflow (recommended)
      - Drizzle: Lightweight, SQL-like syntax, edge-optimized, schema-as-code in TypeScript
      - Kysely: Type-safe SQL query builder, zero magic, excellent PostgreSQL support
      - TypeORM: Feature-rich, Active Record pattern, wide database support
    default: prisma
    choices:
      - prisma
      - drizzle
      - kysely
      - typeorm
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_auth:
    type: str
    help: |
      Select authentication provider:
      - Clerk: Hosted auth, built-in UI components, organizations, passkeys, fastest setup (recommended)
      - Auth.js: Self-hosted, open-source, full control, OAuth providers, lower cost
      - WorkOS: Enterprise SSO (Okta, Azure AD), SCIM provisioning, Directory Sync, B2B focus
      - Supabase Auth: Integrated with Supabase, row-level security (RLS), email/phone/OAuth
    default: clerk
    choices:
      - clerk
      - authjs
      - workos
      - supabase-auth
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_enterprise_bridge:
    type: str
    help: |
      Add enterprise authentication bridge (SSO, SCIM, Directory Sync)?
      - WorkOS: Enterprise-ready SSO (Okta, Azure AD, Google Workspace), SCIM provisioning
      - None: Skip enterprise features for now (pure PLG)
    default: none
    choices:
      - workos
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_billing:
    type: str
    help: |
      Select billing provider:
      - Stripe: Full control, usage metering, widest ecosystem, manual tax handling
      - Paddle: Merchant of Record (MoR), automatic tax/VAT, simpler compliance, higher fees
    default: stripe
    choices:
      - stripe
      - paddle
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_jobs:
    type: str
    help: |
      Select background job system:
      - Trigger.dev: Task-centric, AI-optimized, kicked off from your app, built-in retries
      - Inngest: Event-driven workflows, durable execution, complex orchestration, scheduling
    default: triggerdev
    choices:
      - triggerdev
      - inngest
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_email:
    type: str
    help: |
      Select email provider:
      - Resend: React Email templates, Vercel integration, modern DX, component-based (recommended)
      - Postmark: Industry-leading deliverability, mature service, template management UI
      - SendGrid: Enterprise scale, marketing + transactional, A/B testing, detailed analytics
      - AWS SES: High volume, pay-as-you-go pricing, tight AWS integration, SMTP interface
    default: resend
    choices:
      - resend
      - postmark
      - sendgrid
      - ses
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_analytics:
    type: str
    help: |
      Select analytics platform:
      - PostHog: Product OS (analytics + feature flags + session replay), open-source option
      - Amplitude: Enterprise product analytics, sophisticated cohorts, data warehouse integrations
    default: posthog
    choices:
      - posthog
      - amplitude
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_ai:
    type: str
    help: |
      Select AI provider:
      - OpenAI: GPT-4o/GPT-5, largest ecosystem, best for chat interfaces, function calling (recommended)
      - Anthropic: Claude 4.x, longer context windows (200k+), better for document analysis
      - Google Gemini: Multimodal capabilities, long context (1M+ tokens), cost-effective
      - Ollama: Local LLMs (Llama 3, Mistral), zero API costs, data privacy, offline operation
    default: openai
    choices:
      - openai
      - anthropic
      - gemini
      - ollama
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_storage:
    type: str
    help: |
      Select file storage provider:
      - Cloudflare R2: S3-compatible, zero egress fees, global edge network (recommended)
      - Supabase Storage: Integrated with Supabase platform, RLS policies, image transformations
      - AWS S3: Industry standard, lifecycle policies, glacier archival, CloudFront integration
      - UploadThing: Type-safe uploads, built-in UI components, image/video processing
    default: r2
    choices:
      - r2
      - supabase-storage
      - s3
      - uploadthing
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_cicd:
    type: str
    help: |
      Select CI/CD platform:
      - GitHub Actions: Native GitHub integration, marketplace actions, deploy to Vercel
      - Cloudflare CI: Integrated with Cloudflare Pages/Workers, fast edge deployments
    default: github-actions
    choices:
      - github-actions
      - cloudflare-ci
    when: "{{ saas_starter_module == 'enabled' }}"
  
  # NEW CATEGORIES (Spec 017 Enhancement)
  
  saas_search:
    type: str
    help: |
      Select search provider (optional):
      - Algolia: Premium search, sub-50ms latency, typo tolerance, analytics, merchandising
      - Meilisearch: Open-source, self-hosted or cloud, cost-effective, good performance
      - Typesense: Geo-search, vector search for semantic queries, open-source with support
      - None: Skip search integration (can add later)
    default: none
    choices:
      - algolia
      - meilisearch
      - typesense
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_cache:
    type: str
    help: |
      Select cache provider (optional):
      - Redis (Upstash): Full Redis features, serverless, REST API, pub/sub, geo-replication
      - Cloudflare KV: Edge caching, eventually consistent, unlimited reads, global distribution
      - Vercel KV: Redis-powered, Vercel-optimized, connection pooling, tight integration
      - None: Skip cache integration (can add later)
    default: none
    choices:
      - redis
      - cloudflare-kv
      - vercel-kv
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_feature_flags:
    type: str
    help: |
      Select feature flag provider (optional):
      - LaunchDarkly: Enterprise features, workflow approvals, audit logs, complex targeting
      - PostHog: Integrated with analytics, A/B testing, session replay, cost-effective
      - GrowthBook: Open-source, warehouse-native, Bayesian statistics, self-hosted option
      - None: Skip feature flags (can add later)
    default: none
    choices:
      - launchdarkly
      - posthog-flags
      - growthbook
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_cms:
    type: str
    help: |
      Select CMS provider (optional):
      - Contentful: Enterprise CMS, powerful modeling, localization, workflow, GraphQL + REST
      - Sanity: Real-time collaboration, portable text, image pipeline, GROQ queries
      - Payload CMS: TypeScript-based, Next.js integration, self-hosted, code-first config
      - Strapi: Open-source, customizable admin, plugin system, self-hosted or cloud
      - None: Skip CMS integration (can add later)
    default: none
    choices:
      - contentful
      - sanity
      - payload
      - strapi
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_usage_metering:
    type: str
    help: |
      Select usage metering provider (optional):
      - Stripe Metering: Native Stripe integration, real-time metering, automatic billing
      - Moesif: API analytics + metering, user tracking, billing integrations, governance
      - Amberflo: Real-time metering, prepaid/postpaid, tiered pricing, usage alerts
      - None: Skip usage metering (subscription-only billing)
    default: none
    choices:
      - stripe-metering
      - moesif
      - amberflo
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_secrets:
    type: str
    help: |
      Select secrets management provider (optional):
      - Infisical: Open-source, self-hosted or cloud, versioning, access control, audit logs
      - Doppler: Multi-platform sync, dynamic secrets, integrations (AWS, GCP, Vercel, GitHub)
      - AWS Secrets Manager: AWS-native, automatic rotation, KMS encryption, IAM policies
      - None: Use environment variables only
    default: none
    choices:
      - infisical
      - doppler
      - aws-secrets
      - none
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_error_tracking:
    type: str
    help: |
      Select error tracking provider:
      - Sentry: Comprehensive monitoring, session replay, performance tracking, release health
      - Rollbar: Real-time alerts, intelligent grouping, RQL queries, deploy tracking
      - BugSnag: Mobile-focused, stability monitoring, React Native support, user impact
    default: sentry
    choices:
      - sentry
      - rollbar
      - bugsnag
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_observability_sentry:
    type: bool
    help: Enable Sentry for error tracking?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_observability_datadog:
    type: bool
    help: Enable Datadog for APM (Application Performance Monitoring)?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_observability_otel:
    type: bool
    help: Enable OpenTelemetry instrumentation for traces and metrics?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_observability_structured_logging:
    type: bool
    help: Enable structured JSON logging with correlation IDs?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_include_fixtures:
    type: bool
    help: |
      Include seeded database fixtures with example users, organizations, and subscriptions?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_include_factories:
    type: bool
    help: |
      Include test data factories (Faker.js integration) for generating realistic test data?
    default: true
    when: "{{ saas_starter_module == 'enabled' }}"
  
  saas_test_suite_level:
    type: str
    help: |
      Select test suite coverage level:
      - Standard: Unit tests + integration tests for all services
      - Comprehensive: Standard + E2E tests for critical user flows (signup, billing, dashboard)
    default: standard
    choices:
      - standard
      - comprehensive
    when: "{{ saas_starter_module == 'enabled' }}"

exclude:
  - ".git"
  - ".github"
  - "README.md"
  - "specs/"
  - "config/"
  - "samples/"
  - "scripts/"

tasks:
  post_init:
    - "scripts/hooks/post-init.sh {{ _copier_conf.answers_file }}"
