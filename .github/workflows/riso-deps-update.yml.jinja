{% if ci_platform == 'github-actions' %}
name: Dependency Updates

on:
  schedule:
    # Run weekly on Monday at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:  # Allow manual triggering

env:
  PACKAGE_NAME: {{ package_name }}

jobs:
  update-python-deps:
    name: Update Python Dependencies
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: {% raw %}${{ secrets.GITHUB_TOKEN }}{% endraw %}
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install uv
        run: curl -LsSf https://astral.sh/uv/install.sh | sh
      
      - name: Update Python dependencies
        run: |
          export PATH="$HOME/.local/bin:$PATH"
          uv lock --upgrade
      
      - name: Test with updated dependencies
        run: |
          export PATH="$HOME/.local/bin:$PATH"
          uv sync
          QUALITY_PROFILE={{ quality_profile }} uv run task quality
      
      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          token: {% raw %}${{ secrets.GITHUB_TOKEN }}{% endraw %}
          commit-message: "chore(deps): update Python dependencies"
          title: "chore(deps): Update Python dependencies"
          body: |
            Automated dependency update generated by scheduled workflow.
            
            ## Changes
            - Updated `uv.lock` with latest compatible versions
            
            ## Validation
            - ✅ Quality checks passed with updated dependencies
            - ✅ All tests passed
            
            ## Review Checklist
            - [ ] Review changelog for breaking changes
            - [ ] Test locally with updated dependencies
            - [ ] Merge if all checks pass
          branch: automated/deps-update-python
          delete-branch: true
          labels: dependencies,automated
  
  {% if 'node' in api_tracks %}
  update-node-deps:
    name: Update Node.js Dependencies
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: {% raw %}${{ secrets.GITHUB_TOKEN }}{% endraw %}
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Enable corepack
        run: corepack enable
      
      - name: Update Node.js dependencies
        run: |
          pnpm update --latest
          pnpm install --frozen-lockfile
      
      - name: Test with updated dependencies
        run: |
          pnpm run lint
          pnpm run type-check
          pnpm test
      
      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          token: {% raw %}${{ secrets.GITHUB_TOKEN }}{% endraw %}
          commit-message: "chore(deps): update Node.js dependencies"
          title: "chore(deps): Update Node.js dependencies"
          body: |
            Automated dependency update generated by scheduled workflow.
            
            ## Changes
            - Updated `pnpm-lock.yaml` with latest compatible versions
            
            ## Validation
            - ✅ ESLint checks passed
            - ✅ TypeScript compilation successful
            - ✅ All tests passed
            
            ## Review Checklist
            - [ ] Review changelog for breaking changes
            - [ ] Test locally with updated dependencies
            - [ ] Merge if all checks pass
          branch: automated/deps-update-node
          delete-branch: true
          labels: dependencies,automated
  {% endif %}
{% endif %}
